var GUI;!function(GUI){var WUtil=WUX.WUtil;GUI.getPageComponent=function(){var l=window.location.href;return new(!WUtil.ends(l,"index")&&WUtil.ends(l,"map")?GUI.GUIMap:GUI.GUIDemo)},GUI.getUserLogged=function(){var t=$("#toolbar-item-user");return t.length?t.text():""}}(GUI=GUI||{}),function(GUI){var WUtil=WUX.WUtil,Chart=function(_super){function Chart(id,type,classStyle,style,attributes){id=_super.call(this,id||"*","Chart",type,classStyle,style,attributes)||this;return id.labels=!1,id.legend=!0,id.rotated=!1,id.forceOnChange=!0,id}return __extends(Chart,_super),Chart.prototype.updateState=function(nextState){if(_super.prototype.updateState.call(this,nextState),this.source=[],this.series=[],this.state){var d=this.state.data;if(d&&d.length){var s=this.state.series,v=this.state.values;if(v){var a=this.state.arguments;if(a){for(var t=this.state.argType,noS=!s||s==a,arrayS=(noS&&this.series.push({valueField:"s0",name:this.sTitle||s}),[]),arrayA=[],_i=0,d_1=d;_i<d_1.length;_i++){var dr=d_1[_i];noS||(serVal=dr[s])&&arrayS.indexOf(serVal)<0&&(idx=arrayS.length,arrayS.push(serVal),this.series.push({valueField:"s"+idx,name:serVal})),(argVal=dr[a])&&arrayA.indexOf(argVal)<0&&arrayA.push(argVal)}for(var _a=0,arrayA_1=arrayA;_a<arrayA_1.length;_a++){var d_3,ai=arrayA_1[_a],sr={};"d"==t?(d_3=WUtil.toDate(ai),sr.a=d_3?WUX.formatDate(d_3):ai):sr.a=ai;for(var argVal,serVal,idx,value,_b=0,d_2=d;_b<d_2.length;_b++)(argVal=(dr=d_2[_b])[a])==ai&&(value=(value=dr[v])||0,noS?sr.s0=value:(serVal=dr[s],(idx=arrayS.indexOf(serVal))<0||(sr["s"+idx]=value)));this.source.push(sr)}}}}}},Chart.prototype.componentDidMount=function(){this._tooltip&&this.root.attr("title",this._tooltip),this.title||(this.title=""),this.source||(this.source=[]),this.series||(this.series=[]),this.props||(this.props="bar");var opt={dataSource:this.source,commonSeriesSettings:{argumentField:"a",type:this.props,label:{visible:this.labels},point:{symbol:this.pSymbol,size:this.pSize,visible:this.pVisible}},series:this.series,title:this.title,legend:{verticalAlignment:"bottom",horizontalAlignment:"center",visible:this.legend},export:{enabled:!0},tooltip:{enabled:!0},rotated:this.rotated};this.color&&(opt.commonSeriesSettings.color=this.color),this.palette&&(opt.palette=this.palette),this.xRotate&&(opt.argumentAxis={label:{displayMode:"rotate",rotationAngle:this.xRotate}}),this.subTitle&&(opt.title={text:this.title,subtitle:{text:this.subTitle}}),this.xTitle&&(opt.argumentAxis={title:{text:this.xTitle}}),this.yTitle&&(opt.valueAxis={title:{text:this.yTitle}}),$("#"+this.id).dxChart(opt)},Chart.prototype.getInstance=function(copt){return this.mounted?(copt&&this.root.dxChart(copt),this.root.dxChart("instance")):null},Chart}(WUX.WComponent),Chart=(GUI.Chart=Chart,function(_super){function PieChart(id,type,classStyle,style,attributes){id=_super.call(this,id||"*","PieChart",type,classStyle,style,attributes)||this;return id.labels=!1,id.forceOnChange=!0,id}return __extends(PieChart,_super),PieChart.prototype.updateState=function(nextState){if(_super.prototype.updateState.call(this,nextState),this.source=[],this.series=[],this.state){nextState=this.state.data;if(nextState&&nextState.length){var v=this.state.values;if(v){var a=this.state.arguments;if(a||this.state.series,a){for(var arrayA=[],mapAV={},tot=0,_i=0,d_4=nextState;_i<d_4.length;_i++){var r=d_4[_i];tot+=val=WUtil.getNumber(r,v),(arg=WUtil.getString(r,a))&&(arrayA.indexOf(arg)<0&&arrayA.push(arg),r=WUtil.getNumber(mapAV,arg),mapAV[arg]=r+val)}for(var _a=0,arrayA_2=arrayA;_a<arrayA_2.length;_a++){var arg=arrayA_2[_a],val=WUtil.getNumber(mapAV,arg);this.source.push({a:arg,v:WUtil.round2(tot?100*val/tot:0)})}this.series.push({argumentField:"a",valueField:"v",label:{visible:this.labels,connector:{visible:this.labels,width:1}}})}}}}},PieChart.prototype.componentDidMount=function(){this._tooltip&&this.root.attr("title",this._tooltip),this.title||(this.title=""),this.source||(this.source=[]),this.series||(this.series=[]),this.props||(this.props="pie");var opt={dataSource:this.source,series:this.series,title:this.title,legend:{verticalAlignment:"bottom",horizontalAlignment:"center"},export:{enabled:!0},tooltip:{enabled:!0}};this.palette&&(opt.palette=this.palette),this.subTitle&&(opt.title={text:this.title,subtitle:{text:this.subTitle}}),$("#"+this.id).dxPieChart(opt)},PieChart.prototype.getInstance=function(copt){return this.mounted?(copt&&this.root.dxPieChart(copt),this.root.dxPieChart("instance")):null},PieChart}(WUX.WComponent));GUI.PieChart=Chart}(GUI=GUI||{}),function(GUI){var GUIDemo=function(_super){function GUIDemo(){return _super.call(this,"app-demo","GUIDemo")||this}return __extends(GUIDemo,_super),GUIDemo.prototype.render=function(){var _this=this,options=new Array;return options.push({id:0,text:"(None)"}),options.push({id:1,text:"Option 1"}),options.push({id:2,text:"Option 2"}),this.frmFilter=new WUX.WFormPanel("frmFilter","Filtro"),this.frmFilter.addRow(),this.frmFilter.addCurrency5Field("c","Codice"),this.frmFilter.addOptionsField("o","Opzioni",options),this.frmFilter.addRow(),this.frmFilter.addTextField("d","Descrizione"),this.frmFilter.addDateField("t","Data",!1),this.frmFilter.setValue("t",WUX.WUtil.getCurrDate()),this.frmFilter.on("statechange",function(e){console.log("WFormPanel:statechange",_this.frmFilter.getState()),_this.btnRefresh.trigger("click")}),this.btnRefresh=new WUX.WButton("btnRefresh","Find items",WUX.WIcon.REFRESH,WUX.BTN.PRIMARY,"width: 180px"),this.btnRefresh.tooltip="Button example",this.btnRefresh.on("click",function(e){console.log("btnRefresh:click",_this.frmFilter.getState());for(var result=[],i=0;i<5;i++)result.push([i,"ITEM "+i,new Date,i%2==0]);_this.tabTest.setState(result),WUX.showSuccess(result.length+" items found")}),this.btnDialog=new WUX.WButton("btnDialog","Show Dialog",WUX.WIcon.SHARE_SQUARE_O,WUX.BTN.SECONDARY,"width: 180px"),this.btnDialog.on("click",function(e){console.log("btnDialog:click"),WUX.confirm("Si vuole mostrare la dialog?",function(res){res&&_this.dlgTest.show()})}),this.btnWindow=new WUX.WButton("btnWindow","Show Window",WUX.WIcon.EDIT,WUX.BTN.INFO,"width: 180px"),this.btnWindow.on("click",function(e){console.log("btnWindow:click"),_this.winTest.show()}),this.tabTest=new WUX.WDXTable("tabTest",["Id","Description","DateTime","Flag"]),this.tabTest.filter=!0,this.tabTest.exportFile="export",this.tabTest.css({h:200}),this.tabTest.onSelectionChanged(function(e){console.log("WTable:selectionchange "+e.element.wuxComponent().id)}),this.tabTest.onDoubleClick(function(e){WUX.showWarning("WTable onDoubleClick")}),this.tabTest.onRowPrepared(function(e){switch(WUX.WUtil.getNumber(e.data,"i",0)){case 1:WUX.setCss(e.rowElement,WUX.CSS.WARNING);break;case 3:WUX.setCss(e.rowElement,WUX.CSS.ERROR)}}),this.dlgTest=new WUX.WDialog("dlgTest"),this.dlgTest.header.add("<h4>Test dialog</h4>"),this.dlgTest.body.add("<p>Example of dialog</p>"),this.dlgTest.onShownModal(function(e){console.log("WDialog:shownmodal",e.target)}),this.dlgTest.onHiddenModal(function(e){console.log("WDialog:hiddenmodal ok="+_this.dlgTest.ok)}),this.winTest=new WUX.WWindow("winTest"),this.winTest.width=300,this.winTest.background="#ffffaa",this.winTest.body.add("<p>Example of window</p>"),this.winTest.onShow(function(e){console.log("WWindow:show")}),this.winTest.onHide(function(e){console.log("WWindow:hide")}),this.tcoTest=new WUX.WTab("tcoTest"),this.tcoTest.addTab("First tab",WUX.WIcon.CALENDAR).add("<h1>First tab</h1>"),this.tcoTest.addTab("Second tab",WUX.WIcon.ADDRESS_CARD).add("<h1>Second tab</h1>"),this.tcoTest.addTab("Third tab",WUX.WIcon.CALCULATOR).add("<h1>Third tab</h1>"),this.tcoTest.setState(1),this.tcoTest.on("statechange",function(e){console.log("WTab:statechange",_this.tcoTest.getState())}),this.boxTest=new WUX.WBox("boxTest","Box title"),this.boxTest.content.add("<h1>Box content</h1>"),this.boxTest.footer.add("<p>Footer example</p>"),this.container=new WUX.WContainer,this.container.legend="Demo",this.container.addRow().addCol("col-md-10","padding-left: 0").addBox("Filtro","ibox-filter").add(this.frmFilter).addCol("col-md-2").addStack({p:"4px"},this.btnRefresh,this.btnDialog,this.btnWindow).addRow().addCol("col-md-12").add(this.tabTest).addRow().addDiv(8).addCol("col-md-6").add(this.tcoTest).addCol("col-md-6").add(this.boxTest),WUX.debug=!1,this.tcoTest.debug=!0,this.container},GUIDemo}(WUX.WComponent);GUI.GUIDemo=GUIDemo}(GUI=GUI||{}),function(GUI){var WUtil=WUX.WUtil,GUIMap=function(_super){function GUIMap(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(GUIMap,_super),GUIMap.prototype.render=function(){var _this=this;return this.btnCancel=new WUX.WButton("btc","Clear",WUX.WIcon.UNDO,WUX.BTN.SECONDARY,"width: 130px"),this.btnCancel.tooltip="Clear",this.btnCancel.on("click",function(e){_this.cancel()}),this.btnFind=new WUX.WButton("btf","Markers",WUX.WIcon.SEARCH,WUX.BTN.PRIMARY,"width: 130px"),this.btnFind.tooltip="Markers",this.btnFind.on("click",function(e){_this.find()}),this.btnCenter=new WUX.WButton("btx","Zoom",WUX.WIcon.BOOKMARK,WUX.BTN.INFO,"width: 130px"),this.btnCenter.tooltip="Zoom",this.btnCenter.on("click",function(e){_this.map.centerOn(0)}),this.btnInflate=new WUX.WButton("bti","Inflate",WUX.WIcon.ARROW_CIRCLE_O_UP,WUX.BTN.DANGER,"width: 130px"),this.btnInflate.tooltip="Inflate",this.btnInflate.on("click",function(e){_this.inflated?(_this.map.deflate(0),_this.inflated=!1):(_this.map.inflate(0),_this.inflated=!0)}),this.btnPolygon=new WUX.WButton("btp","Polygon",WUX.WIcon.EDIT,WUX.BTN.INFO,"width: 130px"),this.btnPolygon.tooltip="Polygon",this.btnPolygon.on("click",function(e){_this.map.clearPolygons();var g=JSON.parse('{"type":"MultiPolygon","coordinates":[[[[12.6116,41.9209],[12.7406,41.9267],[12.8047,41.8230],[12.5990,41.8531]]]]}'),t=WUtil.getString(g,"type"),g=WUtil.getArray(g,"coordinates");_this.map.addPolygon(t,g,"Test Polygon","#ff0000",null,function(e){console.log("polygon click ",e),_this.map.showPopup(e,"top")}),_this.map.addPolygon("LineString",[[12.4241,41.9766],[12.377,42.0274],[12.244,42.0523],[12.2682,42.0916]],"Test line","#0000aa")}),this.map=new GUI.OLMap(this.subId("map")),this.map.cfg={lon:12.4846,lat:41.8977,zoom:9},this.container=new WUX.WContainer,this.container.addRow(null,"padding-top:8px;").addCol("col-md-6").section("Map").add(this.map).addCol("col-md-6").section("Actions").addStack(WUX.CSS.STACK_BTNS,this.btnCancel,this.btnFind,this.btnCenter,this.btnInflate,this.btnPolygon),this.container},GUIMap.prototype.cancel=function(){this.map.clear(),this.map.center(12.4846,41.8977,9)},GUIMap.prototype.find=function(){this.map.clearMarkers();var on_hover=this.onMarkerHover.bind(this),on_click=this.onMarkerClick.bind(this);this.map.addMarker(12.2497,41.7981,"Fiumicino Airport","blue",on_hover,on_click),this.map.addMarker(12.5945,41.7978,"Ciampino Airport","red",on_hover,on_click)},GUIMap.prototype.onMarkerHover=function(e){console.log("marker hover ",e),this.map.showPopup(e,"left")},GUIMap.prototype.onMarkerClick=function(e){console.log("marker click ",e),this.map.centerOn(e)},GUIMap}(WUX.WComponent);GUI.GUIMap=GUIMap}(GUI=GUI||{}),function(GUI){var WUtil=WUX.WUtil,OLMap=function(_super){function OLMap(id,classStyle,style,attributes){id=_super.call(this,id||"*","OLMap",null,classStyle,style||"width:100%;height:600px",attributes)||this;return id.imgs="/modules/demo/img/",id.pdx=0,id.pdy=0,id._cfg={},id.markers=[],id.mrkFea=[],id.polygons=[],id.polFea=[],id}return __extends(OLMap,_super),Object.defineProperty(OLMap.prototype,"cfg",{get:function(){return this._cfg},set:function(c){this._cfg=c},enumerable:!1,configurable:!0}),OLMap.prototype.clear=function(){this.clearMarkers(),this.clearPolygons()},OLMap.prototype.clearMarkers=function(){this.markers=[],this.mrkFea=[],this.mounted&&this.mrkLay&&(this.map.removeLayer(this.mrkLay),this.mrkSrc=null,this.mrkLay=null,this.hidePopup())},OLMap.prototype.clearPolygons=function(){this.polygons=[],this.polFea=[],this.mounted&&this.polLay&&(this.map.removeLayer(this.polLay),this.polSrc=null,this.polLay=null,this.hidePopup())},OLMap.prototype.addMarker=function(lon,lat,name,color,onhover,onclick){this.markers.push([lon,lat,name,color,onhover,onclick]),this.mounted&&(this.hidePopup(!1),this._addMarker(lon,lat,name,color))},OLMap.prototype.addPolygon=function(type,coordinates,name,color,onhover,onclick){this.polygons.push([type,coordinates,name,color,onhover,onclick]),this.mounted&&(this.hidePopup(!1),this._addPolygon(type,coordinates,name,color))},OLMap.prototype.addGeometry=function(json,name,color,onhover,onclick){if(json)try{var g=JSON.parse(json);if(!g)return;var t=WUtil.getString(g,"type");if(!t)return;var c=WUtil.getArray(g,"coordinates");if(!c||!c.length)return;"Point"==t?this.addMarker(c[0],c[1],name,color,onhover,onclick):this.addPolygon(t,c,name,color,onhover,onclick)}catch(err){console.error(err+" in addGeometry "+json)}},OLMap.prototype.inflate=function(i){var mi;i<0&&i>=this.mrkFea.length||(mi=this.markers[i],i=this.mrkFea[i],mi=(mi=mi[3])||"blue",i.setStyle(new ol.style.Style({image:new ol.style.Icon({anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:this.imgs+"marker-"+mi+".png",scale:1})})))},OLMap.prototype.deflate=function(i){var mi;i<0&&i>=this.mrkFea.length||(mi=this.markers[i],i=this.mrkFea[i],mi=(mi=mi[3])||"blue",i.setStyle(new ol.style.Style({image:new ol.style.Icon({anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:this.imgs+"marker-"+mi+".png",scale:.6})})))},OLMap.prototype.center=function(lon,lat,zoom){this.hidePopup(!0),(lon||lat)&&(this.view?(this.view.setCenter(ol.proj.fromLonLat([lon,lat])),this.view.setZoom(zoom)):(this._cfg.lon=lon,this._cfg.lat=lat,this._cfg.zoom=zoom))},OLMap.prototype.centerOn=function(o,zoom){void 0===zoom&&(zoom=16);var lon=0,lat=0;if("number"==typeof o){if(!this.markers)return;if(o<0||o>=this.markers.length)return;var m=this.markers[o],lon=m[0],lat=m[1]}else lon=WUtil.getNumber(o,"lon"),lat=WUtil.getNumber(o,"lat");(lon||lat)&&this.center(lon,lat,zoom)},OLMap.prototype.hidePopup=function(hard){this.$popup.popover("hide"),this.popupn="",hard&&(this.map.removeOverlay(this.popup),this.$popup.remove(),hard="",this.pdx&&(hard+="margin-left:"+this.pdx+"px;"),this.pdy&&(hard+="margin-top:"+this.pdy+"px;"),hard=hard&&' style="'+hard+'"',this.$popup=$('<div id="'+this.subId("man-popup")+'"'+hard+"></div>").appendTo("body"),this.popup=new ol.Overlay({element:this.$popup.get(0),positioning:"bottom-center",stopEvent:!1}),this.map.addOverlay(this.popup))},OLMap.prototype.showPopup=function(e,p){void 0===p&&(p="top");var n="",f=e?this.map.forEachFeatureAtPixel(e.pixel,function(f){return f}):null;f&&(n=f.get("name"))==this.popupn||(this.popupn&&this.hidePopup(!0),(this.popupn=n)&&(this.popup.setPosition(e.coordinate),this.$popup.popover({placement:p,html:!0,content:n}),this.$popup.popover("show")))},OLMap.prototype.hexToRgba=function(hex,a){hex=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return hex?"rgba("+parseInt(hex[1],16)+","+parseInt(hex[2],16)+","+parseInt(hex[3],16)+","+(a=a||"1.0")+")":""},OLMap.prototype.componentDidMount=function(){var s,_this=this;if(this._cfg.lon||(this._cfg.lon=12.4846),this._cfg.lat||(this._cfg.lat=41.8977),this._cfg.zoom||(this._cfg.zoom=9),this.share?this.share.view?this.view=this.share.view:(this.view=new ol.View({center:ol.proj.fromLonLat([this._cfg.lon,this._cfg.lat]),zoom:this._cfg.zoom}),this.share.view=this.view):this.view=new ol.View({center:ol.proj.fromLonLat([this._cfg.lon,this._cfg.lat]),zoom:this._cfg.zoom}),this._cfg.controls&&(this.controls=ol.control.defaults.defaults(this._cfg.controls)),this._cfg.interactions&&(this.interactions=ol.interaction.defaults.defaults(this._cfg.interactions)),this.map=new ol.Map({target:this.id,layers:[new ol.layer.Tile({source:new ol.source.OSM})],view:this.view,controls:this.controls,interactions:this.interactions}),this.$popup=$("#"+this.subId("man-popup")),this.$popup.length||(s="",this.pdx&&(s+="margin-left:"+this.pdx+"px;"),this.pdy&&(s+="margin-top:"+this.pdy+"px;"),s=s&&' style="'+s+'"',this.$popup=$('<div id="'+this.subId("man-popup")+'"'+s+"></div>").appendTo("body")),this.popup=new ol.Overlay({element:this.$popup.get(0),positioning:"bottom-center",stopEvent:!1}),this.map.addOverlay(this.popup),this.map.on("click",function(e){_this.hidePopup(!0);var h,f=_this.map.forEachFeatureAtPixel(e.pixel,function(f){return f}),m=_this.getMarker(f),m=(m&&(h=m[5])&&(e.lon=m[0],e.lat=m[1],h(e)),_this.getPolygon(f));m&&(h=m[5])&&h(e)}),this.map.on("pointermove",function(e){var h,x=document.getElementById(_this.map.getTarget()),f=_this.map.forEachFeatureAtPixel(e.pixel,function(f){return f}),m=_this.getMarker(f),c=!1,m=(m&&(h=m[4],m[5]&&(c=!0),h&&(e.lon=m[0],e.lat=m[1],h(e))),_this.getPolygon(f));m&&(h=m[4],m[5]&&(c=!0),h&&h(e)),x.style.cursor=c?"pointer":""}),this.markers)for(var _i=0,_a=this.markers;_i<_a.length;_i++){var m=_a[_i];this._addMarker(m[0],m[1],m[2],m[3])}if(this.polygons)for(var _b=0,_c=this.polygons;_b<_c.length;_b++){var p=_c[_b];this._addPolygon(p[0],p[1],p[2],p[3])}},OLMap.prototype.getMarker=function(f){if(f&&this.markers){f=f.get("name"),f=WUtil.indexOf(this.markers,2,f);if(0<=f)return this.markers[f]}return null},OLMap.prototype.getPolygon=function(f){if(f&&this.polygons){f=f.get("name"),f=WUtil.indexOf(this.polygons,2,f);if(0<=f)return this.polygons[f]}return null},OLMap.prototype._addMarker=function(lon,lat,name,color){lon=new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([lon,lat])),name:name});color=color||"blue",lon.setStyle(new ol.style.Style({image:new ol.style.Icon({anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:this.imgs+"marker-"+color+".png",scale:.6})})),this.mrkFea.push(lon),this.mrkSrc&&this.mrkLay?this.mrkSrc.addFeature(lon):(this.mrkSrc=new ol.source.Vector({features:this.mrkFea}),this.mrkLay=new ol.layer.Vector({source:this.mrkSrc}),this.map.addLayer(this.mrkLay))},OLMap.prototype._addPolygon=function(type,coordinates,name,color){var pf;color=color||"#ff0000","Polygon"==(type=type||"MultiPolygon")?(WUtil.starts(color,"#")&&(color=this.hexToRgba(color,"0.4")),coordinates=this.fromLonLat(coordinates,3),(pf=new ol.Feature({geometry:new ol.geom.Polygon(coordinates),name:name})).setStyle(new ol.style.Style({stroke:new ol.style.Stroke({color:"black",width:1}),fill:new ol.style.Fill({color:color})}))):"LineString"==type?(coordinates=this.fromLonLat(coordinates,2),(pf=new ol.Feature({geometry:new ol.geom.LineString(coordinates),name:name})).setStyle(new ol.style.Style({stroke:new ol.style.Stroke({color:color,width:3})}))):"MultiLineString"==type?(coordinates=this.fromLonLat(coordinates,3),(pf=new ol.Feature({geometry:new ol.geom.MultiLineString(coordinates),name:name})).setStyle(new ol.style.Style({stroke:new ol.style.Stroke({color:color,width:3})}))):(WUtil.starts(color,"#")&&(color=this.hexToRgba(color,"0.4")),coordinates=this.fromLonLat(coordinates,4),(pf=new ol.Feature({geometry:new ol.geom.MultiPolygon(coordinates),name:name})).setStyle(new ol.style.Style({stroke:new ol.style.Stroke({color:"black",width:1}),fill:new ol.style.Fill({color:color})}))),this.polFea.push(pf),this.polSrc&&this.polLay?this.polSrc.addFeature(pf):(this.polSrc=new ol.source.Vector({features:this.polFea}),this.polLay=new ol.layer.Vector({source:this.polSrc}),this.map.addLayer(this.polLay))},OLMap.prototype.fromLonLat=function(c,d){if(1==(d=void 0===d?1:d)){var ll=ol.proj.fromLonLat(c);c[0]=ll[0],c[1]=ll[1]}else if(2==d)for(var _i=0,c_1=c;_i<c_1.length;_i++){var c0=c_1[_i],ll=ol.proj.fromLonLat(c0);c0[0]=ll[0],c0[1]=ll[1]}else if(3==d)for(var _a=0,c_2=c;_a<c_2.length;_a++)for(var _b=0,c0_1=c0=c_2[_a];_b<c0_1.length;_b++){var c1=c0_1[_b],ll=ol.proj.fromLonLat(c1);c1[0]=ll[0],c1[1]=ll[1]}else if(4==d)for(var _c=0,c_3=c;_c<c_3.length;_c++)for(var _d=0,c0_2=c0=c_3[_c];_d<c0_2.length;_d++)for(var _e=0,c1_1=c1=c0_2[_d];_e<c1_1.length;_e++){var c2=c1_1[_e],ll=ol.proj.fromLonLat(c2);c2[0]=ll[0],c2[1]=ll[1]}return c},OLMap}(WUX.WComponent);GUI.OLMap=OLMap}(GUI=GUI||{}),function(GUI){var WUtil=WUX.WUtil,ListFiles=function(_super){function ListFiles(id,classStyle,style,attributes){id=_super.call(this,id||"*","ListFiles","",classStyle,style,attributes)||this;return id.astyle="text-decoration: none;font-size: 1.4rem;cursor: pointer;",id.forceOnChange=!0,id}return __extends(ListFiles,_super),ListFiles.prototype.load=function(path){var _this=this;this.path=path,this.path||(this.path="doc"),this.props="/demo/files/"+this.path,this.rmurl="/demo/del/"+this.path,$.ajax({type:"GET",url:"/demo/list-files/"+path}).done(function(res){!res||res.message?_this.setState([]):_this.setState(res.files)}).fail(function(jqxhr,status,error){console.log("response: "+jqxhr.responseText+", status: "+status+", error: "+error),WUX.showError("Errore nel caricamento della cartella.")})},ListFiles.prototype.render=function(){this.files=[],this.path||(this.path="doc"),this.props||(this.props="/demo/files/"+this.path),this.rmurl||(this.rmurl="/demo/del/"+this.path),this.astyle||(this.astyle="");var r="",isAdmin=!1;if(GUI.getUserLogged()&&(isAdmin=$("body").hasClass("role--administrator"))&&(r=(r=r+('<form id="'+this.subId("frm"))+'" action="/demo/upload" method="post" enctype="multipart/form-data"><div class="row"><div class="form-group col-md-5"><input class="form-control" type="file" name="datafile" id="datafile" required></div>')+'<input type="hidden" name="subfolder" id="subfolder" value="'+this.path+'"><input type="hidden" name="addtime" id="addtime" value="0"><div class="form-group col-md-7"><button type="submit" class="btn btn-primary">Carica il file</button> &nbsp;&nbsp;<button type="reset" class="btn btn-secondary">Annulla</button></div></div></form>'),this.state&&this.state.length){this.state.sort();for(var _i=0,_a=this.state;_i<_a.length;_i++){var item=_a[_i],ico=WUX.buildIcon(this.getIcon(item));ico&&(this.files.push(item),r=(r+='<a href="'+this.props+"/"+item+'" target="_blank" style="'+this.astyle+'" title="Vedi file '+item+'">'+ico+" "+item+"</a>")+(isAdmin?"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+('<a id="del_'+(this.files.length-1)+'" style="'+this.astyle+'color:#800000;">'+WUX.buildIcon("fa-trash")+" Elimina</a>")+"<br>":"<br>"))}}else r+="<h4>Nessun file disponibile al momento.</h4>";return this.buildRoot(this.rootTag,r)},ListFiles.prototype.componentDidMount=function(){var _this=this,frm=(this.root.on("click","a",function(e){var r,x,e=WUX.getId(e.currentTarget);!e||(r=e.indexOf("_"))<0||"del"==e.substring(0,r)&&(x=WUtil.toNumber(e.substring(r+1)),!_this.files||_this.files.length<=x||(e=_this.files[x],WUX.confirm("Si vuole eliminare il file "+e+"?",function(cnf){cnf&&$.ajax({type:"GET",url:_this.rmurl+"/"+_this.files[x]}).done(function(res){_this.load(_this.path)}).fail(function(jqxhr,status,error){console.log("response: "+jqxhr.responseText+", status: "+status+", error: "+error),WUX.showError("Errore durante la cancellazione del file.")})})))}),document.getElementById(this.subId("frm")));frm&&frm.addEventListener("submit",function(e){e.preventDefault();e=new FormData(frm);$.ajax({url:"/demo/upload",type:"POST",data:e,processData:!1,contentType:!1,success:function(response){console.log("upload",response),WUX.showSuccess("File caricato."),_this.load(_this.path)},error:function(jqXHR,textStatus,errorThrow){console.error(textStatus),console.error(errorThrow),WUX.showError("Errore durante l'upload del file.")}})})},ListFiles.prototype.getIcon=function(file){if(!file)return"";var s=file.lastIndexOf(".");if(s<0)return"";if("."==s[0])return"";file=file.substring(s+1).toLowerCase();return"pdf"==file?"fa-file-pdf-o":"xls"==file||"xlsx"==file?"fa-file-excel-o":"doc"==file||"docx"==file?"fa-file-word-o":"ppt"==file||"pptx"==file?"fa-file-powerpoint-o":"txt"==file||"dat"==file||"csv"==file?"fa-file-text-o":"png"==file||"jpeg"==file||"jpg"==file||"bmp"==file||"gif"==file||"tiff"==file||"webp"==file?"fa-file-image-o":"xps"==file?"fa-file-o":"gpkg"==file||"json"==file||"xml"==file||"html"==file||"htm"==file?"fa-file-code-o":"mp4"==file||"avi"==file?"fa-file-video-o":"mp3"==file||"wav"==file||"aac"==file?"fa-file-audio-o":"zip"==file||"tar"==file||"gz"==file?"fa-file-archive-o":""},ListFiles}(WUX.WComponent);GUI.ListFiles=ListFiles}(GUI=GUI||{});